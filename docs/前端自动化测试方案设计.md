# 前端自动化测试方案设计

## 项目概述

基于当前AI文档测试系统前端项目分析，设计一套完整的自动化测试方案。该方案针对React 18 + TypeScript + Vite + Ant Design技术栈，确保代码质量和功能稳定性。

## 1. 技术栈分析

### 当前技术栈
- **框架**: React 18 + TypeScript
- **构建工具**: Vite 5.4.19
- **UI框架**: Ant Design 5.11.5  
- **路由**: React Router DOM 6.20.0
- **HTTP客户端**: Axios 1.6.2
- **状态管理**: Context API + Hooks

### 项目结构
```
src/
├── components/          # 可复用组件
├── pages/              # 页面组件
├── services/           # API服务层
├── hooks/             # 自定义Hooks
├── types.ts           # TypeScript类型定义
├── config/            # 配置文件
└── App.tsx            # 应用入口
```

## 2. 测试框架选择

### 2.1 单元测试和集成测试
**推荐方案**: **Vitest + React Testing Library**

**选择理由**:
1. **Vite原生支持**: Vitest是专为Vite设计的测试框架，完全兼容Vite配置
2. **高性能**: 基于ESM，启动速度快，热更新支持
3. **TypeScript原生支持**: 无需额外配置即可测试TS代码
4. **Jest兼容**: API与Jest高度兼容，学习成本低
5. **React Testing Library**: 专注于用户行为测试，测试更贴近实际使用

### 2.2 端到端测试
**推荐方案**: **Playwright**

**选择理由**:
1. **多浏览器支持**: 支持Chromium、Firefox、Safari
2. **TypeScript原生支持**: 完善的TS类型定义
3. **并行执行**: 支持多浏览器并行测试
4. **自动等待**: 智能等待元素状态，减少flaky测试
5. **丰富的调试功能**: 支持录制、截图、视频等

### 2.3 组件可视化测试
**推荐方案**: **Storybook + Chromatic**

**选择理由**:
1. **组件隔离开发**: 独立开发和测试组件
2. **视觉回归测试**: 自动检测UI变化
3. **文档生成**: 自动生成组件文档
4. **Ant Design兼容**: 完美支持Ant Design组件

## 3. 测试类型设计

### 3.1 单元测试 (Unit Tests)

#### 测试覆盖范围
- **工具函数**: 70% 覆盖率
- **自定义Hooks**: 90% 覆盖率  
- **服务层函数**: 80% 覆盖率
- **组件逻辑**: 60% 覆盖率

#### 测试重点
1. **API服务层测试** (`src/services/`)
   - 请求参数正确性
   - 响应数据处理
   - 错误处理逻辑
   - 认证token处理

2. **自定义Hooks测试** (`src/hooks/`)
   - 状态更新逻辑
   - 副作用处理
   - 依赖变化响应

3. **组件逻辑测试**
   - Props验证
   - 状态变化
   - 事件处理
   - 条件渲染

### 3.2 集成测试 (Integration Tests)

#### 测试场景
1. **页面级组件测试**
   - 组件间数据传递
   - 路由跳转逻辑
   - API调用集成
   - 状态管理集成

2. **用户交互流程测试**
   - 表单提交流程
   - 文件上传流程
   - 用户认证流程
   - 数据展示更新

### 3.3 端到端测试 (E2E Tests)

#### 核心业务流程
1. **用户登录流程**
2. **任务创建流程** 
3. **任务管理流程**
4. **文件上传处理**
5. **报告查看导出**

## 4. 测试策略

### 4.1 测试金字塔
```
    /\     E2E Tests (20%)
   /  \    - 核心业务流程
  /    \   - 关键用户场景
 /______\  
/        \ Integration Tests (30%)
\        / - 页面级组件测试
 \______/  - API集成测试
/        \ 
\        / Unit Tests (50%) 
 \______/  - 组件逻辑测试
           - 工具函数测试
```

### 4.2 测试覆盖率目标
- **总体覆盖率**: ≥ 80%
- **函数覆盖率**: ≥ 85%
- **分支覆盖率**: ≥ 75%
- **行覆盖率**: ≥ 80%

### 4.3 测试数据管理

#### Mock策略
1. **API Mock**: 使用MSW (Mock Service Worker)
   - 拦截网络请求
   - 模拟真实API响应
   - 支持不同场景测试

2. **组件Mock**: 使用jest.mock()
   - Mock复杂第三方组件
   - Mock文件上传组件
   - Mock图表组件

3. **环境变量Mock**: 
   - 测试环境配置
   - API地址配置
   - 功能开关配置

#### 测试数据工厂
```typescript
// testFactory.ts
export const userFactory = {
  admin: () => ({
    id: 1,
    uid: 'admin',
    display_name: '管理员',
    is_admin: true,
    is_system_admin: false
  }),
  regular: () => ({
    id: 2,
    uid: 'user001',
    display_name: '普通用户',
    is_admin: false,
    is_system_admin: false
  })
};

export const taskFactory = {
  pending: () => ({
    id: 1,
    title: '测试任务',
    status: 'pending',
    progress: 0,
    created_at: '2024-01-01T00:00:00Z'
  })
};
```

## 5. 工具链配置

### 5.1 依赖包安装
```json
{
  "devDependencies": {
    "@testing-library/react": "^13.4.0",
    "@testing-library/jest-dom": "^5.16.5",
    "@testing-library/user-event": "^14.4.3",
    "vitest": "^1.0.4",
    "jsdom": "^22.1.0",
    "msw": "^2.0.0",
    "@playwright/test": "^1.40.0",
    "@storybook/react": "^7.6.0",
    "@storybook/addon-essentials": "^7.6.0",
    "chromatic": "^10.0.0",
    "@types/testing-library__jest-dom": "^5.14.9"
  }
}
```

### 5.2 Vite测试配置
```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./src/test/setup.ts'],
    css: true,
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/',
        'src/test/',
        '**/*.d.ts',
        '**/*.config.*',
        'dist/'
      ],
      thresholds: {
        global: {
          branches: 75,
          functions: 85,
          lines: 80,
          statements: 80
        }
      }
    }
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src')
    }
  }
});
```

### 5.3 测试环境设置
```typescript
// src/test/setup.ts
import '@testing-library/jest-dom';
import { server } from './mocks/server';

// 启动mock服务器
beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());

// Mock localStorage
const localStorageMock = {
  getItem: vi.fn(),
  setItem: vi.fn(),
  removeItem: vi.fn(),
  clear: vi.fn(),
};
global.localStorage = localStorageMock;

// Mock window.matchMedia
Object.defineProperty(window, 'matchMedia', {
  writable: true,
  value: vi.fn().mockImplementation(query => ({
    matches: false,
    media: query,
    onchange: null,
    addListener: vi.fn(),
    removeListener: vi.fn(),
    addEventListener: vi.fn(),
    removeEventListener: vi.fn(),
    dispatchEvent: vi.fn(),
  })),
});
```

### 5.4 MSW Mock设置
```typescript
// src/test/mocks/server.ts
import { setupServer } from 'msw/node';
import { handlers } from './handlers';

export const server = setupServer(...handlers);

// src/test/mocks/handlers.ts
import { http, HttpResponse } from 'msw';

export const handlers = [
  // 登录接口Mock
  http.post('/api/auth/thirdparty/login', () => {
    return HttpResponse.json({
      success: true,
      user: {
        id: 1,
        uid: 'testuser',
        display_name: '测试用户',
        is_admin: false
      },
      access_token: 'mock-token'
    });
  }),

  // 任务列表接口Mock
  http.get('/api/tasks', () => {
    return HttpResponse.json([
      {
        id: 1,
        title: '测试任务',
        status: 'completed',
        progress: 100
      }
    ]);
  }),

  // 文件上传Mock
  http.post('/api/tasks', () => {
    return HttpResponse.json({
      id: 2,
      title: '新任务',
      status: 'pending'
    });
  })
];
```

### 5.5 Playwright配置
```typescript
// playwright.config.ts
import { defineConfig, devices } from '@playwright/test';

export default defineConfig({
  testDir: './e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'http://localhost:3000',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
    video: 'retain-on-failure'
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },
    {
      name: 'Mobile Chrome',
      use: { ...devices['Pixel 5'] },
    }
  ],
  webServer: {
    command: 'npm run dev',
    url: 'http://localhost:3000',
    reuseExistingServer: !process.env.CI,
  },
});
```

### 5.6 CI/CD集成 (GitHub Actions)
```yaml
# .github/workflows/test.yml
name: Test

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  unit-test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run unit tests
      run: npm run test:unit
    
    - name: Upload coverage
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage/lcov.info
  
  e2e-test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Install Playwright Browsers
      run: npx playwright install --with-deps
    
    - name: Run E2E tests
      run: npm run test:e2e
    
    - uses: actions/upload-artifact@v3
      if: always()
      with:
        name: playwright-report
        path: playwright-report/
        retention-days: 30

  visual-test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Build Storybook
      run: npm run build-storybook
    
    - name: Publish to Chromatic
      uses: chromaui/action@v1
      with:
        projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}
```

## 6. 具体测试场景设计

### 6.1 用户登录流程测试

#### 单元测试
```typescript
// src/services/__tests__/authService.test.ts
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { loginWithThirdParty, getCurrentUser } from '../authService';

describe('AuthService', () => {
  beforeEach(() => {
    localStorage.clear();
    vi.clearAllMocks();
  });

  it('should handle successful third party login', async () => {
    const mockResult = {
      success: true,
      user: { id: 1, uid: 'testuser' },
      access_token: 'token123'
    };
    
    const result = await loginWithThirdParty('auth-code');
    
    expect(result.success).toBe(true);
    expect(result.user.uid).toBe('testuser');
    expect(localStorage.setItem).toHaveBeenCalledWith('token', 'token123');
  });

  it('should handle login failure', async () => {
    const result = await loginWithThirdParty('invalid-code');
    
    expect(result.success).toBe(false);
    expect(result.message).toBe('认证失败');
  });
});
```

#### 集成测试
```typescript
// src/pages/__tests__/LoginPage.test.tsx
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { BrowserRouter } from 'react-router-dom';
import LoginPage from '../LoginPage';

const renderWithRouter = (component: React.ReactNode) => {
  return render(<BrowserRouter>{component}</BrowserRouter>);
};

describe('LoginPage', () => {
  it('should render third party login button', () => {
    renderWithRouter(<LoginPage />);
    
    expect(screen.getByRole('button', { name: /第三方登录/i })).toBeInTheDocument();
  });

  it('should handle system login form submission', async () => {
    const user = userEvent.setup();
    renderWithRouter(<LoginPage />);
    
    // 切换到系统登录标签
    await user.click(screen.getByText('系统登录'));
    
    // 填写表单
    await user.type(screen.getByPlaceholderText('请输入用户名'), 'admin');
    await user.type(screen.getByPlaceholderText('请输入密码'), 'admin123');
    
    // 提交表单
    await user.click(screen.getByRole('button', { name: /立即登录/i }));
    
    // 验证API调用
    await waitFor(() => {
      expect(screen.getByText('登录成功')).toBeInTheDocument();
    });
  });

  it('should show loading state during login', async () => {
    const user = userEvent.setup();
    renderWithRouter(<LoginPage />);
    
    await user.click(screen.getByRole('button', { name: /第三方登录/i }));
    
    expect(screen.getByRole('button', { name: /处理中/i })).toBeInTheDocument();
  });
});
```

#### E2E测试
```typescript
// e2e/login.spec.ts
import { test, expect } from '@playwright/test';

test.describe('User Login', () => {
  test('should login with third party authentication', async ({ page }) => {
    await page.goto('/login');
    
    // 验证登录页面加载
    await expect(page.locator('.login-container')).toBeVisible();
    await expect(page.locator('h1:has-text("AI文档测试系统")')).toBeVisible();
    
    // 点击第三方登录按钮
    await page.click('button:has-text("第三方登录")');
    
    // 在开发环境下会模拟登录
    await expect(page.locator('text=登录成功')).toBeVisible();
    
    // 验证跳转到主页
    await expect(page).toHaveURL('/');
    await expect(page.locator('text=任务列表')).toBeVisible();
  });

  test('should login with system credentials', async ({ page }) => {
    await page.goto('/login');
    
    // 切换到系统登录标签
    await page.click('div[data-node-key="2"]');
    
    // 填写登录表单
    await page.fill('input[placeholder="请输入用户名"]', 'admin');
    await page.fill('input[placeholder="请输入密码"]', 'admin123');
    
    // 提交表单
    await page.click('button:has-text("立即登录")');
    
    // 验证登录成功
    await expect(page.locator('text=登录成功')).toBeVisible();
    await expect(page).toHaveURL('/');
  });

  test('should handle login failure', async ({ page }) => {
    await page.goto('/login');
    
    // 切换到系统登录
    await page.click('div[data-node-key="2"]');
    
    // 输入错误凭据
    await page.fill('input[placeholder="请输入用户名"]', 'wronguser');
    await page.fill('input[placeholder="请输入密码"]', 'wrongpass');
    
    await page.click('button:has-text("立即登录")');
    
    // 验证错误提示
    await expect(page.locator('.ant-message-error')).toBeVisible();
  });
});
```

### 6.2 任务创建流程测试

#### 单元测试
```typescript
// src/pages/__tests__/TaskCreate.test.tsx
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import TaskCreate from '../TaskCreate';

describe('TaskCreate', () => {
  it('should render task creation form', () => {
    render(<TaskCreate />);
    
    expect(screen.getByText('创建新任务')).toBeInTheDocument();
    expect(screen.getByLabelText('任务标题')).toBeInTheDocument();
    expect(screen.getByText('上传文档')).toBeInTheDocument();
  });

  it('should validate required fields', async () => {
    const user = userEvent.setup();
    render(<TaskCreate />);
    
    // 直接点击创建按钮
    await user.click(screen.getByRole('button', { name: /创建任务/i }));
    
    // 验证错误信息
    await waitFor(() => {
      expect(screen.getByText('请输入任务标题')).toBeInTheDocument();
      expect(screen.getByText('请上传文档文件')).toBeInTheDocument();
    });
  });

  it('should handle file upload', async () => {
    const user = userEvent.setup();
    render(<TaskCreate />);
    
    const file = new File(['test content'], 'test.pdf', { type: 'application/pdf' });
    const fileInput = screen.getByLabelText('上传文档');
    
    await user.upload(fileInput, file);
    
    expect(screen.getByText('test.pdf')).toBeInTheDocument();
  });

  it('should submit task creation form', async () => {
    const user = userEvent.setup();
    render(<TaskCreate />);
    
    // 填写表单
    await user.type(screen.getByLabelText('任务标题'), '测试任务');
    
    const file = new File(['test content'], 'test.pdf', { type: 'application/pdf' });
    const fileInput = screen.getByLabelText('上传文档');
    await user.upload(fileInput, file);
    
    // 提交表单
    await user.click(screen.getByRole('button', { name: /创建任务/i }));
    
    await waitFor(() => {
      expect(screen.getByText('任务创建成功')).toBeInTheDocument();
    });
  });
});
```

#### E2E测试
```typescript
// e2e/task-create.spec.ts
import { test, expect } from '@playwright/test';
import path from 'path';

test.describe('Task Creation', () => {
  test.beforeEach(async ({ page }) => {
    // 登录
    await page.goto('/login');
    await page.click('button:has-text("第三方登录")');
    await expect(page).toHaveURL('/');
  });

  test('should create a new task', async ({ page }) => {
    // 导航到创建任务页面
    await page.click('a:has-text("创建任务")');
    await expect(page).toHaveURL('/create');
    
    // 填写任务标题
    await page.fill('input[placeholder="请输入任务标题"]', '自动化测试任务');
    
    // 上传文件
    const filePath = path.join(__dirname, 'fixtures', 'sample.pdf');
    await page.setInputFiles('input[type="file"]', filePath);
    
    // 等待文件上传完成
    await expect(page.locator('text=sample.pdf')).toBeVisible();
    
    // 提交表单
    await page.click('button:has-text("创建任务")');
    
    // 验证成功消息
    await expect(page.locator('.ant-message-success')).toBeVisible();
    
    // 验证跳转到任务详情页
    await expect(page).toHaveURL(/\/task\/\d+/);
    await expect(page.locator('text=自动化测试任务')).toBeVisible();
  });

  test('should validate file type', async ({ page }) => {
    await page.goto('/create');
    
    // 尝试上传不支持的文件类型
    const filePath = path.join(__dirname, 'fixtures', 'invalid.txt');
    await page.setInputFiles('input[type="file"]', filePath);
    
    // 验证错误提示
    await expect(page.locator('text=不支持的文件类型')).toBeVisible();
  });

  test('should show upload progress', async ({ page }) => {
    await page.goto('/create');
    
    await page.fill('input[placeholder="请输入任务标题"]', '进度测试任务');
    
    const filePath = path.join(__dirname, 'fixtures', 'large.pdf');
    await page.setInputFiles('input[type="file"]', filePath);
    
    // 验证进度条显示
    await expect(page.locator('.ant-progress')).toBeVisible();
    
    await page.click('button:has-text("创建任务")');
    
    // 验证上传完成
    await expect(page.locator('.ant-message-success')).toBeVisible();
  });
});
```

### 6.3 任务列表展示测试

#### 单元测试
```typescript
// src/pages/__tests__/TaskList.test.tsx
import { render, screen, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { BrowserRouter } from 'react-router-dom';
import TaskList from '../TaskList';

const renderWithRouter = (component: React.ReactNode) => {
  return render(<BrowserRouter>{component}</BrowserRouter>);
};

describe('TaskList', () => {
  it('should render task list with data', async () => {
    renderWithRouter(<TaskList />);
    
    await waitFor(() => {
      expect(screen.getByText('测试任务')).toBeInTheDocument();
      expect(screen.getByText('completed')).toBeInTheDocument();
    });
  });

  it('should handle empty task list', async () => {
    renderWithRouter(<TaskList />);
    
    await waitFor(() => {
      expect(screen.getByText('暂无任务数据')).toBeInTheDocument();
    });
  });

  it('should filter tasks by status', async () => {
    const user = userEvent.setup();
    renderWithRouter(<TaskList />);
    
    // 等待任务列表加载
    await waitFor(() => {
      expect(screen.getByText('测试任务')).toBeInTheDocument();
    });
    
    // 点击状态筛选
    await user.click(screen.getByText('已完成'));
    
    // 验证筛选结果
    await waitFor(() => {
      expect(screen.getAllByText('completed')).toHaveLength(1);
    });
  });

  it('should navigate to task detail', async () => {
    const user = userEvent.setup();
    renderWithRouter(<TaskList />);
    
    await waitFor(() => {
      expect(screen.getByText('测试任务')).toBeInTheDocument();
    });
    
    // 点击任务标题
    await user.click(screen.getByText('测试任务'));
    
    // 验证导航到详情页
    expect(window.location.pathname).toMatch(/\/task\/\d+/);
  });

  it('should refresh task list', async () => {
    const user = userEvent.setup();
    renderWithRouter(<TaskList />);
    
    // 点击刷新按钮
    await user.click(screen.getByRole('button', { name: /刷新/i }));
    
    // 验证加载状态
    expect(screen.getByText('加载中...')).toBeInTheDocument();
    
    await waitFor(() => {
      expect(screen.getByText('测试任务')).toBeInTheDocument();
    });
  });
});
```

### 6.4 文件上传功能测试

#### 单元测试
```typescript
// src/components/__tests__/FileUpload.test.tsx
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import FileUpload from '../FileUpload';

describe('FileUpload', () => {
  it('should accept valid file types', async () => {
    const user = userEvent.setup();
    const onUpload = vi.fn();
    
    render(<FileUpload onUpload={onUpload} />);
    
    const file = new File(['test'], 'test.pdf', { type: 'application/pdf' });
    const input = screen.getByLabelText('文件上传');
    
    await user.upload(input, file);
    
    expect(onUpload).toHaveBeenCalledWith(file);
  });

  it('should reject invalid file types', async () => {
    const user = userEvent.setup();
    const onUpload = vi.fn();
    
    render(<FileUpload onUpload={onUpload} />);
    
    const file = new File(['test'], 'test.exe', { type: 'application/exe' });
    const input = screen.getByLabelText('文件上传');
    
    await user.upload(input, file);
    
    await waitFor(() => {
      expect(screen.getByText('不支持的文件类型')).toBeInTheDocument();
    });
    
    expect(onUpload).not.toHaveBeenCalled();
  });

  it('should validate file size', async () => {
    const user = userEvent.setup();
    const onUpload = vi.fn();
    
    render(<FileUpload maxSize={1024} onUpload={onUpload} />);
    
    // 创建大文件 (超过1KB)
    const largeContent = 'x'.repeat(2048);
    const file = new File([largeContent], 'large.pdf', { type: 'application/pdf' });
    const input = screen.getByLabelText('文件上传');
    
    await user.upload(input, file);
    
    await waitFor(() => {
      expect(screen.getByText('文件大小超出限制')).toBeInTheDocument();
    });
    
    expect(onUpload).not.toHaveBeenCalled();
  });

  it('should show upload progress', async () => {
    const user = userEvent.setup();
    
    render(<FileUpload showProgress />);
    
    const file = new File(['test'], 'test.pdf', { type: 'application/pdf' });
    const input = screen.getByLabelText('文件上传');
    
    await user.upload(input, file);
    
    expect(screen.getByRole('progressbar')).toBeInTheDocument();
  });

  it('should handle upload error', async () => {
    const user = userEvent.setup();
    const onError = vi.fn();
    
    render(<FileUpload onError={onError} />);
    
    // 模拟上传失败
    const file = new File(['test'], 'error.pdf', { type: 'application/pdf' });
    const input = screen.getByLabelText('文件上传');
    
    await user.upload(input, file);
    
    await waitFor(() => {
      expect(onError).toHaveBeenCalledWith('上传失败');
    });
  });
});
```

## 7. 测试报告与CI/CD

### 7.1 测试脚本配置
```json
{
  "scripts": {
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest run --coverage",
    "test:unit": "vitest run src/**/*.{test,spec}.{ts,tsx}",
    "test:integration": "vitest run src/**/*.integration.{test,spec}.{ts,tsx}",
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui",
    "test:e2e:debug": "playwright test --debug",
    "storybook": "storybook dev -p 6006",
    "build-storybook": "storybook build",
    "chromatic": "npx chromatic --project-token=$CHROMATIC_PROJECT_TOKEN"
  }
}
```

### 7.2 测试报告生成
1. **覆盖率报告**: HTML + JSON格式
2. **E2E测试报告**: Playwright HTML报告
3. **可视化测试报告**: Chromatic差异报告
4. **持续集成报告**: GitHub Actions Status

### 7.3 质量门禁
- 单元测试通过率: 100%
- 覆盖率达标: ≥80%
- E2E测试通过率: 100%
- 无高危安全漏洞
- TypeScript类型检查通过
- ESLint代码规范检查通过

## 8. 实施步骤

### 阶段一: 基础环境搭建 (Week 1)
1. 安装测试依赖包
2. 配置Vite测试环境
3. 设置MSW API mock
4. 创建测试工具函数

### 阶段二: 单元测试开发 (Week 2-3)
1. 服务层函数测试
2. 自定义Hooks测试
3. 工具函数测试
4. 组件逻辑测试

### 阶段三: 集成测试开发 (Week 4)
1. 页面组件测试
2. 用户交互测试
3. API集成测试
4. 状态管理测试

### 阶段四: E2E测试开发 (Week 5)
1. Playwright环境搭建
2. 关键业务流程测试
3. 跨浏览器兼容性测试
4. 移动端适配测试

### 阶段五: CI/CD集成 (Week 6)
1. GitHub Actions配置
2. 自动化测试流水线
3. 测试报告集成
4. 质量门禁设置

## 9. 维护策略

### 9.1 测试用例维护
- **定期评估**: 每月评估测试用例有效性
- **及时更新**: 功能更新时同步更新测试
- **移除冗余**: 清理失效或重复的测试用例
- **性能优化**: 优化慢速测试用例

### 9.2 测试数据管理
- **数据隔离**: 测试间数据完全隔离
- **数据清理**: 测试后自动清理数据
- **真实数据**: 使用接近生产的测试数据
- **边界测试**: 包含边界值和异常数据

### 9.3 团队协作
- **测试培训**: 定期进行测试最佳实践培训
- **代码评审**: 测试代码纳入Code Review
- **知识分享**: 分享测试经验和工具使用技巧
- **持续改进**: 根据反馈持续优化测试策略

## 10. 总结

本测试方案通过分层的测试策略，确保AI文档测试系统前端的代码质量和功能稳定性。通过单元测试保证基础逻辑正确性，集成测试验证组件间协作，E2E测试确保用户体验，最终形成完整的质量保障体系。

实施此方案将显著提升:
- **代码质量**: 通过全面的测试覆盖减少bug
- **开发效率**: 自动化测试减少手动验证时间
- **重构信心**: 完善的测试保障安全重构
- **团队协作**: 标准化的测试流程提升协作效率
- **用户体验**: 端到端测试确保功能完整性

该方案充分考虑了项目的技术特点和业务需求，提供了切实可行的实施路径和维护策略，为项目的长期发展奠定坚实基础。